const socket = io(); const outputLog = document.getElementById('outputLog'); const promptPrefix = document.getElementById('promptPrefix'); const mainInput = document.getElementById('mainInput'); let myName = 'guest';
function addLog(html, className = '') { const line = document.createElement('div'); if (className) line.className = className; line.innerHTML = html; outputLog.appendChild(line); outputLog.scrollTop = outputLog.scrollHeight; }
function initializeLobby() { outputLog.innerHTML = ''; addLog('<div class="system-bold">get ethical ai</div>'); addLog('<div class="system-italic">free ai - free your mind</div>'); addLog('<div>&nbsp;</div>'); addLog('<div>For support, resources, and rebellion, join the <a href="https://discord.gg/C54EvvMYKV" target="_blank" rel="noopener noreferrer" class="discord-link">Discord</a>.</div>'); addLog('<div>...or fall down the sleepy rabbit hole at the <a href="https://graciela5504.hocoos.com/blog" target="_blank" rel="noopener noreferrer" class="discord-link">old blog</a>.</div>'); addLog('<div>&nbsp;</div>'); addLog("<div class='system-loading message'>Connecting to Hub...</div>"); }
socket.on('connect', initializeLobby);
socket.on('welcome', (data) => { const loadingLine = outputLog.querySelector('.system-loading'); if (loadingLine) loadingLine.remove(); myName = data.name; localStorage.setItem('geteai_userName', myName); promptPrefix.textContent = `${myName}> `; addLog(`<div class="message system-bold">Connection established. You are <span class="user-message-name">${myName}</span>.</div>`); addLog("<div class='message system-italic'>Type /help for a list of available worlds.</div>"); });
socket.on('systemMessage', (data) => { addLog(`<div class="message system-italic">${data.message}</div>`); });
socket.on('newMessage', (data) => { const userClass = data.user === myName ? 'user-message-name' : 'machine-msg-name'; addLog(`<div class="message"><span class="${userClass}">${data.user}:</span> <span class="message-content">${data.message}</span></div>`); });
socket.on('redirect', (data) => { window.location.href = data.url; });
mainInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { const inputText = mainInput.value.trim(); if (!inputText) return; addLog(`<div class="echo message">> ${inputText}</div>`); mainInput.value = ''; socket.emit('lobbyMessage', inputText); } });
document.body.addEventListener('click', () => { if (!mainInput.disabled) { mainInput.focus(); } });